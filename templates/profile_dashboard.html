{% extends "_base.html" %}
{% load static %}

{% block head %}
  <title>Profile Dashboard | Boren Import</title>
{% endblock head %}

{% block body %}

  <section class="bg-center bg-no-repeat bg-cover h-[250px] flex justify-center items-center"
    style="background-image: linear-gradient(rgba(3, 19, 192, 0.56),rgba(3, 19, 192, 0.56)),url({% static 'assets/about-us-header.jpg' %})">
    <div class="container max-w-screen-xl px-2 mx-auto text-white ">
      <h1 class="text-center text-3xl md:text-[45px] leading-[45px] font-extrabold">Dashboard </h1>
    </div>
  </section>

<main class="pt-20 pb-32 px-4">
    <div class="w-full max-w-3xl mx-auto">
        <div class="flex items-center justify-between mb-6">
            <h1 class="text-2xl font-bold">Your Submitted Forms</h1>
        </div>
        <div class="grid gap-4">
            <h2>Your Procurements</h2>

            {% if user_procurements|length == 0 %}
                <div class="text-center">
                    <p class="">you haven't make any precurement yet</p>
                    <a href="{% url "procurement_form" %}" class="btn-small bg-primary w-fit">make precurement</a>
                </div>
            {% endif %}

            {% for form in user_procurements %}
            <div class="rounded-lg border bg-card text-card-foreground shadow-sm p-4" data-accordion="collapse">
                <div class="flex items-center justify-between">
                    <h3 class="text-lg font-medium">{{form.business_name}} - {{form.customer_type}}</h3>
                    <div class="px-2 py-1 rounded-full text-xs font-medium bg-yellow-100 text-yellow-800">{{form.date_submitted}}</div>
                </div>
                <div class="mt-2 flex justify-between">
                    <a href="{% url 'procurement_detail' form_id=form.id %}" class="text-primary" href="#">
                        View details
                    </a>
                    <button data-accordion-target="#chat-container-{{form.id}}" aria-expanded="false" class="inline-flex items-center justify-center text-sm transition-colors h-9 rounded-md px-3"type="button" >
                        <svg data-accordion-icon class="w-3 h-3 rotate-180 shrink-0" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 10 6">
                            <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5 5 1 1 5"/>
                          </svg>
                        <span class="sr-only">Toggle</span>
                     </button>
                </div>


                {% include 'components/chat.html' with chat_id=form.id %}
            </div>
            {% endfor %}

            
        </div>
    </div>
</main>

<script>
    const currentUserEmail = "{{ request.user.email }}";
    const isUserStaff = "{{ request.user.is_staff }}"
    const csrfToken = "{{ csrf_token }}";
    const staticUrl = "{% static '' %}";
</script>
<script src="{% static 'js/chat.js' %}" defer></script>


{% endblock body %}